#!/bin/bash
# Install and sync ClawdHub skills (download only, no symlinking)

SCRIPT_DIR="$(cd "$(dirname "$0")/.." && pwd)"
CLAWDHUB_DIR="$SCRIPT_DIR/clawdhub"
CONFIG="$SCRIPT_DIR/config.yml"

# Parse from config.yml
skills=$(awk '
  $0 ~ "^clawdhub_skills:" { in_list=1; next }
  in_list && /^[a-z_]+:/ { exit }
  in_list && /^  - / { gsub(/^  - /, ""); gsub(/#.*/, ""); gsub(/[[:space:]]+$/, ""); if ($0) print }
' "$CONFIG")

if [[ -z "$skills" ]]; then
  echo "No ClawdHub skills configured"
  exit 0
fi

mkdir -p "$CLAWDHUB_DIR"

for skill in $skills; do
  echo "Installing $skill..."
  npx clawdhub@latest install "$skill" --workdir "$CLAWDHUB_DIR" 2>/dev/null || true
done

echo "Updating all ClawdHub skills..."
npx clawdhub@latest update --all --workdir "$CLAWDHUB_DIR"

echo "Done!"
